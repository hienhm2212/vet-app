<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <!-- Page header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="mb-1">
            <i class="bi bi-pencil-square text-primary me-2"></i>
            Sửa lịch hẹn
          </h2>
          <p class="text-muted mb-0">
            Cho <%= @patient.name %> (Chủ nuôi: <%= @patient.owner.name %>)
          </p>
        </div>
      </div>



      <!-- Appointment form -->
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card shadow-sm">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="bi bi-form me-2"></i>
                Thông tin lịch hẹn
              </h5>
            </div>
            <div class="card-body">
              <%= form_with model: [@patient.owner, @patient, @appointment], local: true do |form| %>
                <% if @appointment.errors.any? %>
                  <div class="alert alert-danger">
                    <h6>Có lỗi xảy ra:</h6>
                    <ul class="mb-0">
                      <% @appointment.errors.full_messages.each do |message| %>
                        <li><%= message %></li>
                      <% end %>
                    </ul>
                  </div>
                <% end %>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <%= form.label :veterinarian_name, "Tên bác sĩ thú y", class: "form-label" %>
                      <%= form.text_field :veterinarian_name, class: "form-control", required: true, placeholder: "Nhập tên bác sĩ thú y" %>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <%= form.label :scheduled_at, "Ngày giờ hẹn", class: "form-label" %>
                      <%= form.datetime_local_field :scheduled_at, class: "form-control", required: true %>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <%= form.label :appointment_type, "Loại lịch hẹn", class: "form-label" %>
                      <%= form.select :appointment_type, 
                          options_for_select([
                            ["Tư vấn", "consultation"],
                            ["Tiêm chủng", "vaccination"],
                            ["Phẫu thuật", "surgery"],
                            ["Khám bệnh", "checkup"]
                          ], @appointment.appointment_type), 
                          { prompt: "Chọn loại lịch hẹn" }, 
                          { class: "form-select", required: true } %>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <%= form.label :status, "Trạng thái", class: "form-label" %>
                      <%= form.select :status, 
                          options_for_select([
                            ["Đã lên lịch", "scheduled"],
                            ["Đang khám", "in_progress"],
                            ["Hoàn thành", "completed"],
                            ["Đã hủy", "cancelled"]
                          ], @appointment.status), 
                          {}, 
                          { class: "form-select" } %>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <%= form.label :notes, "Ghi chú", class: "form-label" %>
                  <%= form.text_area :notes, rows: 4, class: "form-control", placeholder: "Ghi chú về lịch hẹn..." %>
                </div>

                <div class="d-flex justify-content-between">
                  <%= link_to owner_patient_appointment_path(@patient.owner, @patient, @appointment), class: "btn btn-outline-secondary" do %>
                    <i class="bi bi-arrow-left me-2"></i>
                    Hủy
                  <% end %>
                  <%= form.submit "Cập nhật lịch hẹn", class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Current appointment info -->
      <div class="row justify-content-center mt-4">
        <div class="col-md-8">
          <div class="card shadow-sm">
            <div class="card-header">
              <h6 class="card-title mb-0">
                <i class="bi bi-info-circle me-2"></i>
                Thông tin hiện tại
              </h6>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <dl class="row mb-0">
                    <dt class="col-sm-4">Ngày giờ:</dt>
                    <dd class="col-sm-8"><%= format_datetime(@appointment.scheduled_at) %></dd>

                    <dt class="col-sm-4">Loại:</dt>
                    <dd class="col-sm-8"><%= @appointment.display_type %></dd>

                    <dt class="col-sm-4">Trạng thái:</dt>
                    <dd class="col-sm-8">
                      <span class="<%= status_badge_class(@appointment.status) %>">
                        <%= @appointment.display_status %>
                      </span>
                    </dd>
                  </dl>
                </div>
                <div class="col-md-6">
                  <dl class="row mb-0">
                    <dt class="col-sm-4">Tạo lúc:</dt>
                    <dd class="col-sm-8"><%= format_datetime(@appointment.created_at) %></dd>

                    <dt class="col-sm-4">Cập nhật:</dt>
                    <dd class="col-sm-8"><%= format_datetime(@appointment.updated_at) %></dd>
                  </dl>
                </div>
              </div>

              <% if @appointment.notes.present? %>
                <hr>
                <div class="row">
                  <div class="col-12">
                    <h6>Ghi chú hiện tại:</h6>
                    <p class="text-muted"><%= @appointment.notes %></p>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
