<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><%= link_to 'Chủ nuôi', owners_path %></li>
          <li class="breadcrumb-item"><%= link_to @owner.name, owner_path(@owner) %></li>
          <li class="breadcrumb-item"><%= link_to 'Bệnh nhân', owner_patients_path(@owner) %></li>
          <li class="breadcrumb-item"><%= link_to @patient.name, owner_patient_path(@owner, @patient) %></li>
          <li class="breadcrumb-item active">Sửa</li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Sửa thông tin Bệnh nhân: <%= @patient.name %></h1>
        <%= link_to 'Quay lại', owner_patient_path(@owner, @patient), class: 'btn btn-secondary' %>
      </div>

      <!-- Patient form -->
      <div class="card shadow-sm">
        <div class="card-header">
          <h5 class="card-title mb-0">Thông tin Bệnh nhân</h5>
        </div>
        <div class="card-body">
          <%= form_with model: [@owner, @patient], local: true, class: "needs-validation", novalidate: true do |form| %>
            <% if @patient.errors.any? %>
              <div class="alert alert-danger">
                <h6><%= pluralize(@patient.errors.count, "lỗi") %> đã xảy ra:</h6>
                <ul class="mb-0">
                  <% @patient.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :name, "Tên thú cưng", class: "form-label" %>
                  <%= form.text_field :name, class: "form-control #{'is-invalid' if @patient.errors[:name].any?}", required: true, placeholder: "Nhập tên thú cưng" %>
                  <% if @patient.errors[:name].any? %>
                    <div class="invalid-feedback">
                      <%= @patient.errors[:name].join(', ') %>
                    </div>
                  <% end %>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :species, "Loài", class: "form-label" %>
                  <%= form.select :species,
                      options_for_select([
                        ["Chó", "Chó"],
                        ["Mèo", "Mèo"],
                        ["Chim", "Chim"],
                        ["Cá", "Cá"],
                        ["Thỏ", "Thỏ"],
                        ["Hamster", "Hamster"],
                        ["Khác", "Khác"]
                      ], @patient.species),
                      { prompt: "Chọn loài" },
                      { class: "form-select #{'is-invalid' if @patient.errors[:species].any?}", required: true } %>
                  <% if @patient.errors[:species].any? %>
                    <div class="invalid-feedback">
                      <%= @patient.errors[:species].join(', ') %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :breed, "Giống", class: "form-label" %>
                  <%= form.text_field :breed, class: "form-control", placeholder: "Nhập giống thú cưng" %>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :gender, "Giới tính", class: "form-label" %>
                  <%= form.select :gender,
                      options_for_select([
                        ["Đực", "male"],
                        ["Cái", "female"]
                      ], @patient.gender),
                      { prompt: "Chọn giới tính" },
                      { class: "form-select #{'is-invalid' if @patient.errors[:gender].any?}", required: true } %>
                  <% if @patient.errors[:gender].any? %>
                    <div class="invalid-feedback">
                      <%= @patient.errors[:gender].join(', ') %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <%= form.label :age, "Tuổi (năm)", class: "form-label" %>
                  <%= form.number_field :age, class: "form-control", min: 0, max: 50, placeholder: "Nhập tuổi" %>
                </div>
              </div>

              <div class="col-md-4">
                <div class="mb-3">
                  <%= form.label :weight, "Cân nặng (kg)", class: "form-label" %>
                  <%= form.number_field :weight, class: "form-control", min: 0, step: 0.1, placeholder: "Nhập cân nặng" %>
                </div>
              </div>

              <div class="col-md-4">
                <div class="mb-3">
                  <%= form.label :notes, "Ghi chú", class: "form-label" %>
                  <%= form.text_area :notes, class: "form-control", rows: 3, placeholder: "Ghi chú về thú cưng" %>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-end gap-2">
              <%= link_to 'Hủy', owner_patient_path(@owner, @patient), class: 'btn btn-secondary' %>
              <%= form.submit 'Cập nhật', class: 'btn btn-warning' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
